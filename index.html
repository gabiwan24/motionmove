<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>MOTION SVG mit Gyroskop (Dynamische Kanten)</title>
  <style>
    :root {
      color-scheme: dark;
    }
    * {
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      width: 100%;
      overflow: hidden;
    }
    body {
      margin: 0;
      display: grid;
      place-items: center;
      background: #111;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    
    /* NEU: SVG füllt den gesamten Bildschirm, unabhängig vom Seitenverhältnis */
    svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden; 
    }

    #permission-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      text-align: center;
      color: white;
      padding: 20px;
      z-index: 10;
    }

    #permission-button {
      font-size: 1.2rem;
      padding: 15px 30px;
      margin-top: 20px;
      border-radius: 12px;
      border: 1px solid #fff;
      background-color: #333;
      color: #fff;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s;
    }

    #version-display {
      position: absolute;
      top: 15px;
      left: 15px;
      color: rgba(255, 255, 255, 0.3);
      font-size: 14px;
      z-index: 5;
    }
  </style>
</head>
<body>

  <div id="version-display">v1.9</div>

  <div id="permission-overlay">
    <h1>Kanten-Dynamik</h1>
    <p>Bitte tippen, um den Zugriff auf die Bewegungssensoren zu erlauben.</p>
    <button id="permission-button">Starten</button>
  </div>

  <svg id="motion-svg" xmlns="http://www.w3.org/2000/svg" fill="white">
    <rect id="gyro-square" x="0" y="0" width="150" height="150" />
  </svg>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const permissionOverlay = document.getElementById('permission-overlay');
      const permissionButton = document.getElementById('permission-button');
      
      const svg = document.getElementById('motion-svg');
      const square = document.getElementById('gyro-square');
      
      // NEU: Bildschirmauflösung dynamisch erkennen
      const screenWidth = window.innerWidth;
      const screenHeight = window.innerHeight;
      
      // NEU: SVG-ViewBox an die Bildschirmgröße anpassen
      svg.setAttribute('viewBox', `0 0 ${screenWidth} ${screenHeight}`);
      const viewBox = { width: screenWidth, height: screenHeight };

      const minWidth = 150;
      const minHeight = 150;
      const centerX = viewBox.width / 2;
      const centerY = viewBox.height / 2;
      
      const neutralLeft = centerX - minWidth / 2;
      const neutralRight = centerX + minWidth / 2;
      const neutralTop = centerY - minHeight / 2;
      const neutralBottom = centerY + minHeight / 2;

      gsap.set(square, { x: neutralLeft, y: neutralTop, width: minWidth, height: minHeight });

      let forceX = 0, forceY = 0;
      
      function handleOrientation(event) {
        const gamma = event.gamma || 0; 
        const beta = event.beta || 0;   
        
        const tiltRangeX = 45.0; 
        const tiltRangeY = 45.0; // Der Bereich von 45° (neutral) zu 0° oder 90°
        const deadzone = 2.0; 

        let newForceX = 0;
        if (Math.abs(gamma) > deadzone) {
            newForceX = gsap.utils.clamp(-1, 1, gamma / tiltRangeX);
        }
        forceX = newForceX;
        
        // NEU: Korrigierte Logik für die Beta-Achse
        let newForceY = 0;
        const calibratedBeta = beta - 45; // 45° ist die Mitte
        if (Math.abs(calibratedBeta) > deadzone) {
            // Positive Werte -> nach unten neigen, Negative Werte -> nach oben neigen
            newForceY = gsap.utils.clamp(-1, 1, calibratedBeta / tiltRangeY);
        }
        forceY = newForceY;
      }

      function updateAnimation() {
        let newLeft = neutralLeft;
        let newRight = neutralRight;
        let newTop = neutralTop;
        let newBottom = neutralBottom;

        // Kanten basierend auf der Kraft ausdehnen
        if (forceX > 0) { // Nach rechts
            newRight = neutralRight + forceX * (viewBox.width - neutralRight);
        } else if (forceX < 0) { // Nach links
            newLeft = neutralLeft + forceX * neutralLeft;
        }

        if (forceY > 0) { // Nach unten (Handy aufrecht)
            newBottom = neutralBottom + forceY * (viewBox.height - neutralBottom);
        } else if (forceY < 0) { // Nach oben (Handy flach)
            newTop = neutralTop + forceY * neutralTop; 
        }
        
        const newWidth = newRight - newLeft;
        const newHeight = newBottom - newTop;

        gsap.to(square, { 
            x: newLeft, 
            y: newTop, 
            width: newWidth, 
            height: newHeight,
            duration: 0.5,
            ease: "power2.out"
        });

        requestAnimationFrame(updateAnimation);
      }
      
      function startAnimation() {
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission()
                .then(permissionState => {
                    if (permissionState === 'granted') {
                        window.addEventListener('deviceorientation', handleOrientation);
                        permissionOverlay.style.display = 'none';
                        requestAnimationFrame(updateAnimation); 
                    } else {
                        permissionOverlay.innerHTML = "<p>Zugriff auf Sensoren wurde verweigert.</p>";
                    }
                })
                .catch(console.error);
        } else {
            window.addEventListener('deviceorientation', handleOrientation);
            permissionOverlay.style.display = 'none';
            requestAnimationFrame(updateAnimation);
        }
      }

      permissionButton.addEventListener('click', startAnimation);
    });
  </script>
</body>
</html>
